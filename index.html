<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Out Of Page Ad</title>
    <style>
        body {
            width: 100vw !important;
            max-width: 100vw !important;
            height: 100vh !important;
            max-height: 100vh !important;
            display: block;
            position: relative;
            margin: 0;
            padding: 0;
            background-image: url('background.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        #startAdOutside {
            display: inline-block;
            padding: 10px 20px;
            background-color: #fff;
            color: #000;
            font-size: 16px;
            border: 1px solid #ccc;
            cursor: pointer;
            position: relative;
            z-index: 100000;
        }

        #div-gpt-ad-1763151050915-0 {
            width: 100vw !important;
            max-width: 100vw !important;
            height: 100vh !important;
            max-height: 100vh !important;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 99999;
            display: block;
            border: red 1px;
            padding: 5px;
        }

        #div-gpt-ad-1763151050915-0>div {
            width: 100vw !important;
            max-width: 100vw !important;
            height: 100vh !important;
            max-height: 100vh !important;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 99999;
            display: none;
        }
    </style>
  
    <script async id="gpt" src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script>
        const script = document.getElementById("gpt")

        script.addEventListener("load", () => {
            console.log("GPT cargado OK");
        });

        script.addEventListener("error", () => {
            console.error("Error cargando GPT");
        });

        initVast();

        window.addEventListener("message", function (event) {

            console.log(event);

            if (!event || !event.data) return;

            if (event.data?.source != "gam" || event.data?.type !== "gam_event") return;

            switch (event.data.event) {
                case "click":
                    console.log("Recibido click: " + event.data.extra);
                    break;
                case "completed":
                    console.log("Recibido completed");
                    cerrarCreatividad();
                    break;
                case "error":
                    console.log("Recibido error: " + event.data.extra);
                    cerrarCreatividad();
                    break;
                case "close":
                    console.log("Recibido gam_close_creative");
                    cerrarCreatividad();
                    break;
            }
        });

        function cerrarCreatividad() {
            const adDiv = document.getElementById('div-gpt-ad-1763151050915-0');
            adDiv.style.display = "none";
        }

        function initVast() {
            window.googletag = window.googletag || { cmd: [] };
            let slot;

            googletag.cmd.push(function () {
                // Crear slot OOP
                slot = googletag.defineOutOfPageSlot(
                    "/21628222637/Banner_OpenWeb",
                    "div-gpt-ad-1763151050915-0"
                );

                if (slot) {
                    slot.setTargeting("muted", "true");
                    slot.addService(googletag.pubads());
                    googletag.pubads().enableSingleRequest();
                    googletag.enableServices();
                    googletag.display("div-gpt-ad-1763151050915-0");

                    googletag.pubads().addEventListener('slotOnload', function (event) {
                        console.log("slotOnload");
                        console.log(event);
                    });

                    googletag.pubads().addEventListener('impressionViewable', function (event) {
                        console.log("impressionViewable");
                        console.log(event);
                    });

                    googletag.pubads().addEventListener('slotVisibilityChanged', function (event) {
                        console.log("slotVisibilityChanged");
                        console.log(event);
                    });

                    googletag.pubads().addEventListener('slotResponseReceived', function (event) {
                        console.log("slotResponseReceived");
                        console.log(event);
                    });

                    googletag.pubads().addEventListener('slotRenderEnded', function (event) {
                        console.log("slotRenderEnded:", event);

                        if (event.slot === slot) {
                            console.log("El anuncio del slot OOP se ha renderizado.");
                            const c = document.getElementById("div-gpt-ad-1763151050915-0");

                            // Tamaño que tú quieras para el anuncio:
                            c.style.width = "100vw";
                            c.style.height = "100vh";
                            c.style.position = "fixed";
                            c.style.top = "0";
                            c.style.left = "0";
                            c.style.zIndex = "999999";
                            c.style.background = "black"; // opcional

                            const iframe = document
                                .getElementById("div-gpt-ad-1763151050915-0")
                                .querySelector("iframe");

                            if (iframe) {
                                iframe.style.width = "100vw";
                                iframe.style.height = "100vh";
                            }
                        }
                    });
                }
            });
        }
    </script>
</head>

<body>
    <button id="startAdOutside" aria-hidden="true" style="display:none;">Ver anuncio</button>
    <div id="div-gpt-ad-1763151050915-0">

    </div>

    <script>
        const startBtn = document.getElementById("startAdOutside");

        startBtn.addEventListener("click", function () {
            console.log("Click → googletag.display");
            const adDiv = document.getElementById('div-gpt-ad-1763151050915-0');

            adDiv.style.setProperty('display', 'block', 'important');
            initVast();
        });

    </script>

</body>

</html>
